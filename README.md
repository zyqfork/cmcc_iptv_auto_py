# ðŸ“º å¹¿ä¸œç§»åŠ¨IPTVè‡ªåŠ¨æŠ“å–è„šæœ¬

å…¨æµç¨‹è‡ªåŠ¨åŒ–çš„å¹¿ä¸œç§»åŠ¨IPTVé¢‘é“åˆ—è¡¨å’ŒEPGèŠ‚ç›®å•æŠ“å–å·¥å…·ï¼Œæ”¯æŒé¢‘é“åˆ†ç»„ã€é»‘åå•è¿‡æ»¤ã€è‡ªå®šä¹‰é¢‘é“åˆå¹¶ã€åˆ†ç»„æŽ’åºã€å›žçœ‹åŠŸèƒ½ç­‰ã€‚

**ç‰ˆæœ¬æ—¥æœŸ**: 2025.11.20

## ðŸŽ¯ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

- **ðŸ“¥ è‡ªåŠ¨ä¸‹è½½é¢‘é“åˆ—è¡¨**ï¼šä»Žå¹¿ä¸œç§»åŠ¨IPTVæœåŠ¡å™¨è‡ªåŠ¨èŽ·å–é¢‘é“JSONæ•°æ®ï¼ˆè¦æ±‚èƒ½è®¿é—®183.235.0.0/16ç½‘æ®µï¼‰
- **ðŸ—‚ï¸ æ™ºèƒ½é¢‘é“åˆ†ç»„**ï¼šè‡ªåŠ¨å°†é¢‘é“åˆ†ç±»ä¸ºå¤®è§†ã€å¤®è§†ç‰¹è‰²ã€å¹¿ä¸œã€å«è§†ã€å°‘å„¿ã€CGTNã€åŽæ•°å’ªå’•ã€è¶…æ¸…4kã€å¹¿ä¸œåœ°æ–¹å°ã€å…¶ä»–ç­‰åˆ†ç»„
- **ðŸ”„ é¢‘é“åŽ»é‡**ï¼šè‡ªåŠ¨åŽ»é™¤é‡å¤é¢‘é“ï¼Œå¤šæ¸…æ™°åº¦çš„å‰”é™¤äº†æ ‡æ¸…é¢‘é“ï¼Œåªä¿ç•™é«˜æ¸…/è¶…æ¸…/4kç‰ˆæœ¬
- **ðŸš« é»‘åå•è¿‡æ»¤**ï¼šæ”¯æŒæŒ‰æ ‡é¢˜å…³é”®è¯ã€é¢‘é“ä»£ç (code)æˆ–æ’­æ”¾é“¾æŽ¥(zteurl)è¿‡æ»¤é¢‘é“
- **âž• è‡ªå®šä¹‰é¢‘é“åˆå¹¶**ï¼šé€šè¿‡ `custom_channels.json` æ·»åŠ è‡ªå®šä¹‰é¢‘é“
- **ðŸ“Š åˆ†ç»„æŽ’åº**ï¼šé€šè¿‡ `channel_order.json` è‡ªå®šä¹‰å„åˆ†ç»„å†…é¢‘é“çš„æŽ’åº
- **ðŸ·ï¸ é¢‘é“åç§°æ˜ å°„**ï¼šæ”¯æŒé¢‘é“åç§°æ˜ å°„ï¼ˆå¦‚ "CCTV-3é«˜æ¸…" â†’ "CCTV-3ç»¼è‰º"ï¼‰ï¼Œåªä¿®æ”¹æœ€åŽåå­—ï¼Œtvg-id tvg-name é€‚é…ä¸å½±å“EPGå¯¹é½

### ðŸ“‹ M3Uæ–‡ä»¶ç”Ÿæˆ

è„šæœ¬ä¼šç”Ÿæˆ3ä¸ªM3Uæ–‡ä»¶ï¼š

1. **tv.m3u**ï¼šç»„æ’­åœ°å€åˆ—è¡¨ï¼ˆåŽŸå§‹ç»„æ’­åœ°å€ï¼‰
2. **tv2.m3u**ï¼šå•æ’­åœ°å€åˆ—è¡¨ï¼ˆé€šè¿‡msd_liteè½¬æ¢çš„ç»„æ’­åœ°å€ï¼Œé»˜è®¤å›žçœ‹å‚æ•°æ”¯æŒokå½±è§†,mytv-android[ç”µè§†ç›´æ’­]ï¼‰
3. **ku9.m3u**ï¼šå•æ’­åœ°å€åˆ—è¡¨ï¼ˆå›žçœ‹å‚æ•°æ ¼å¼åªæ”¯æŒ é…·9 1.76+ï¼‰

### ðŸ“º EPGèŠ‚ç›®å•

- **â¬‡ï¸ è‡ªåŠ¨ä¸‹è½½EPG**ï¼šæ ¹æ®é¢‘é“codeè‡ªåŠ¨ä¸‹è½½EPGæ•°æ®
- **ðŸŒ æ”¯æŒå¤šæºä¸‹è½½**ï¼šå¯é…ç½®å¤šä¸ªEPGä¸‹è½½æºï¼Œè‡ªåŠ¨åˆ†é…ä»»åŠ¡
- **âš™ï¸ ä¸‹è½½æ¨¡å¼**ï¼š
  - `M3U_ONLY`ï¼šä»…ä¸‹è½½M3Uæ–‡ä»¶ä¸­åŒ…å«çš„é¢‘é“EPGï¼ˆæŽ¨èï¼‰
  - `ALL`ï¼šä¸‹è½½æ‰€æœ‰å¯ç”¨é¢‘é“çš„EPGï¼ˆåŒ…æ‹¬è¢«è¿‡æ»¤çš„é¢‘é“ï¼‰
- **ðŸ“¦ ç”Ÿæˆæ–‡ä»¶**ï¼š
  - `t.xml`ï¼šXMLæ ¼å¼çš„EPGèŠ‚ç›®å•
  - `t.xml.gz`ï¼šåŽ‹ç¼©åŽçš„EPGæ–‡ä»¶
  - `epg_statistics.log`ï¼šEPGä¸‹è½½ç»Ÿè®¡æ—¥å¿—

### âª å›žçœ‹åŠŸèƒ½

- **ðŸ” è‡ªåŠ¨è¯†åˆ«**ï¼šæ ¹æ®JSONä¸­çš„ `timeshiftAvailable` æˆ– `lookbackAvailable` å­—æ®µè‡ªåŠ¨æ·»åŠ å›žçœ‹å‚æ•°
- **ðŸ“ åŒæ¨¡æ¿æ”¯æŒ**ï¼š
  - æ ‡å‡†å›žçœ‹æ¨¡æ¿ï¼šé€‚é…OKå½±è§†_3.16,,mytv-android_V2.0.0.191[ç”µè§†ç›´æ’­]ç­‰æ’­æ”¾å™¨
  - KU9å›žçœ‹æ¨¡æ¿ï¼šé€‚é…é…·9 1.76+
- **ðŸŒ Nginxä»£ç†æ”¯æŒ**ï¼šæ”¯æŒé€šè¿‡Nginxä»£ç†å›žçœ‹æºï¼Œå®žçŽ°å¤–ç½‘è®¿é—®

### ðŸ“ æ—¥å¿—æ–‡ä»¶

- **channel_processing.log**ï¼šé¢‘é“å¤„ç†æ—¥å¿—ï¼Œè®°å½•åŽ»é‡ã€æ”¹åã€é»‘åå•è¿‡æ»¤ç­‰æ“ä½œ
- **epg_statistics.log**ï¼šEPGä¸‹è½½å’Œåˆæˆç»Ÿè®¡ä¿¡æ¯

## âš™ï¸ é…ç½®è¯´æ˜Ž

### åŸºæœ¬é…ç½®

åœ¨ `tv.py` æ–‡ä»¶é¡¶éƒ¨ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š

```python
# UDPXYåœ°å€ï¼ˆç»„æ’­è½¬å•æ’­ï¼‰
REPLACEMENT_IP = "http://c.top:7088/udp"

# âª å›žçœ‹æºå‰ç¼€ï¼Œæš‚æ—¶æ˜¯ä¸­å…´å¹³å°çš„å›žçœ‹æ ¼å¼ï¼Œç§»åŠ¨éƒ½é€‚ç”¨ï¼ŒåŽä¸ºçš„å›žçœ‹é¢‘é“å‚æ•°å¹¶æ²¡æœ‰å®žçŽ°ï¼Œä½†æ˜¯åŽä¸ºç›’å­çš„ä¹Ÿèƒ½ç”¨ä¸­å…´æ ¼å¼çš„
CATCHUP_SOURCE_PREFIX = "http://183.235.162.80:6610/190000002005"

# ðŸŒ Nginxä»£ç†å‰ç¼€ï¼ˆç”¨äºŽå¤–ç½‘è®¿é—®ï¼‰é»˜è®¤ä¸ºç©º ""ï¼Œåªåœ¨å±€åŸŸç½‘ç”Ÿæ•ˆ
NGINX_PROXY_PREFIX = "http://c.top:7077"

# JSONæ•°æ®æºåœ°å€
JSON_URL = "http://183.235.16.92:8082/epg/api/custom/getAllChannel.json"

# ðŸ“º EPGä¸‹è½½æºï¼ˆé»˜è®¤ä¸ºä¸¤ä¸ªåœ°å€ï¼Œå¯ä»¥åˆ é™¤ä¸€ä¸ªï¼‰
EPG_BASE_URLS = [
    "http://183.235.16.92:8082/epg/api/channel/",
    "http://183.235.11.39:8082/epg/api/channel/"
]
```

### âª å›žçœ‹æ¨¡æ¿é…ç½®

```python
# æ ‡å‡†å›žçœ‹æ¨¡æ¿ï¼ˆOKå½±è§†ç­‰ï¼‰
CATCHUP_URL_TEMPLATE = "{prefix}/{ztecode}/index.m3u8?starttime=${{utc:yyyyMMddHHmmss}}&endtime=${{utcend:yyyyMMddHHmmss}}"

# KU9å›žçœ‹æ¨¡æ¿ï¼ˆé…·9æœ€æ–°ç‰ˆï¼‰
CATCHUP_URL_KU9 = "{prefix}/{ztecode}/index.m3u8?starttime=${{(b)yyyyMMddHHmmss|UTC}}&endtime=${{(e)yyyyMMddHHmmss|UTC}}"
```

### ðŸ“º EPGé…ç½®

```python
# EPGä¸‹è½½å¼€å…³
ENABLE_EPG_DOWNLOAD = True  # True-å¯ç”¨, False-ç¦ç”¨

# EPGä¸‹è½½æ¨¡å¼
EPG_DOWNLOAD_MODE = "M3U_ONLY"  # "M3U_ONLY" æˆ– "ALL"

# EPGåˆæˆæ¨¡å¼
XML_SKIP_CHANNELS_WITHOUT_EPG = True  # True-è·³è¿‡æ— EPGçš„é¢‘é“, False-ä¿ç•™é¢‘é“æ ‡ç­¾
```

### ðŸš« é»‘åå•é…ç½®

```python
BLACKLIST_RULES = {
    "title": ["æµ‹è¯•é¢‘é“", "è´­ç‰©", "å¯¼è§†", "ç™¾è§†é€š", "æŒ‡å—", "ç²¾é€‰é¢‘é“"],
    "code": [
        # æ·»åŠ è¦è¿‡æ»¤çš„é¢‘é“ä»£ç 
    ],
    "zteurl": [
        # æ·»åŠ è¦è¿‡æ»¤çš„æ’­æ”¾é“¾æŽ¥
    ]
}
```

## ðŸ“‹ é…ç½®æ–‡ä»¶

### custom_channels.json

è‡ªå®šä¹‰é¢‘é“é…ç½®æ–‡ä»¶ï¼Œæ ¼å¼ç¤ºä¾‹ï¼š

```json
{
    "å¹¿ä¸œåœ°æ–¹å°": [
            {
        "title": "éŸ¶å…³ç»¼åˆé«˜æ¸…",
        "code": "02000004000000052014120300000003",
        "ztecode": "",
        "icon": "http://183.235.16.92:8081/pics/micro-picture/channel/2020-11-04/e56deee4-990e-443d-8568-0f01953aed53.png",
        "zteurl": "rtp://239.11.0.84:1025",
        "supports_catchup": false,
        "quality": "é«˜æ¸…"
        }
    ]
}
```

**âš ï¸ æ³¨æ„**ï¼šå¦‚æžœè‡ªå®šä¹‰äº†æ–°çš„åˆ†ç»„ï¼Œéœ€è¦åœ¨ `tv.py` çš„ `GROUP_DEFINITIONS` å’Œ `GROUP_OUTPUT_ORDER` ä¸­æ·»åŠ å¯¹åº”çš„åˆ†ç»„åç§°ã€‚

### channel_order.json

é¢‘é“æŽ’åºé…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆçš„m3uä¼šä¼˜å…ˆæŒ‰æ­¤åˆ—è¡¨è¿›è¡ŒæŽ’åºï¼Œæ ¼å¼ç¤ºä¾‹ï¼š

```json
{
    "å¤®è§†": [
        "CCTV-1ç»¼åˆ",
        "CCTV-2è´¢ç»",
        "CCTV-3ç»¼è‰º"
    ],

    "å¹¿ä¸œ": [
        "å¹¿ä¸œç æ±Ÿé«˜æ¸…",
        "å¹¿ä¸œä½“è‚²é«˜æ¸…",
        "å¹¿ä¸œæ–°é—»é«˜æ¸…",
        "ä¸œèŽžæ–°é—»ç»¼åˆé«˜æ¸…",
        "ä¸œèŽžç”Ÿæ´»èµ„è®¯é«˜æ¸…",
        "å¹¿å·žæ–°é—»é«˜æ¸…",
        "å¹¿å·žç»¼åˆé«˜æ¸…",
        "å¹¿ä¸œå«è§†é«˜æ¸…",
        "å¹¿ä¸œæ°‘ç”Ÿé«˜æ¸…",
        "ç»æµŽç§‘æ•™é«˜æ¸…",
        "å¤§æ¹¾åŒºå«è§†é«˜æ¸…"
    ]
}
```

## ðŸš€ ä½¿ç”¨æ–¹æ³•

### 1. çŽ¯å¢ƒè¦æ±‚

- ðŸ Python 3.x

### 2. è¿è¡Œè„šæœ¬

```bash
python tv.py
```

### 3. è¿è¡Œæ•ˆæžœç¤ºä¾‹

```
ä½ çš„ç»„æ’­è½¬å•æ’­UDPXYåœ°å€æ˜¯ http://c.cc.top:7088/udp/
ä½ çš„å›žçœ‹æºå‰ç¼€æ˜¯ http://183.235.162.80:6610/190000002005
ä½ çš„nginxä»£ç†å‰ç¼€æ˜¯ http://c.cc.top:7077/
ä½ çš„å›žçœ‹URLæ¨¡æ¿æ˜¯ {prefix}/{ztecode}/index.m3u8?starttime=${{utc:yyyyMMddHHmmss}}&endtime=${{utcend:yyyyMMddHHmmss}}
ä½ çš„KU9å›žçœ‹URLæ¨¡æ¿æ˜¯ {prefix}/{ztecode}/index.m3u8?starttime=${{(b)yyyyMMddHHmmss|UTC}}&endtime=${{(e)yyyyMMddHHmmss|UTC}}
EPGä¸‹è½½å¼€å…³: å¯ç”¨
EPGä¸‹è½½é…ç½®: é‡è¯•3æ¬¡, è¶…æ—¶15ç§’, é—´éš”2ç§’
æˆåŠŸåŠ è½½é¢‘é“æŽ’åºæ–‡ä»¶: channel_order.json
æˆåŠŸåŠ è½½è‡ªå®šä¹‰é¢‘é“æ–‡ä»¶: custom_channels.json
è‡ªå®šä¹‰é¢‘é“é…ç½®: ['å¹¿ä¸œ', 'å¹¿ä¸œåœ°æ–¹å°']
  åˆ†ç»„ 'å¹¿ä¸œ' æœ‰ 5 ä¸ªé¢‘é“
  åˆ†ç»„ 'å¹¿ä¸œåœ°æ–¹å°' æœ‰ 27 ä¸ªé¢‘é“
æˆåŠŸèŽ·å– JSON æ•°æ®ä»Ž http://183.235.16.92:8082/epg/api/custom/getAllChannel.json
å·²è¿‡æ»¤ 14 ä¸ªé»‘åå•é¢‘é“ï¼ˆä¸»JSONï¼‰
è‡ªå®šä¹‰é¢‘é“åç§°æ˜ å°„: 'å¹¿å·žæ–°é—»-æµ‹è¯•' -> 'å¹¿å·žæ–°é—»é«˜æ¸…'
è‡ªå®šä¹‰é¢‘é“åç§°æ˜ å°„: 'å¹¿å·žç»¼åˆ-æµ‹è¯•' -> 'å¹¿å·žç»¼åˆé«˜æ¸…'
å·²å°†å›žçœ‹æºä»£ç†è‡³: http://c.cc.top:7077/183.235.162.80:6610/190000002005
å·²ä¸º 150 ä¸ªæ”¯æŒå›žçœ‹çš„é¢‘é“æ·»åŠ catchupå±žæ€§
å·²ç”ŸæˆM3Uæ–‡ä»¶: tv.m3u
å·²å°†å›žçœ‹æºä»£ç†è‡³: http://c.cc.top:7077/183.235.162.80:6610/190000002005
å·²ä¸º 150 ä¸ªæ”¯æŒå›žçœ‹çš„é¢‘é“æ·»åŠ catchupå±žæ€§
å·²ç”ŸæˆM3Uæ–‡ä»¶: tv2.m3u
å·²å°†å›žçœ‹æºä»£ç†è‡³: http://c.cc.top:7077/183.235.162.80:6610/190000002005
å·²ä¸º 150 ä¸ªæ”¯æŒå›žçœ‹çš„é¢‘é“æ·»åŠ catchupå±žæ€§
å·²ç”ŸæˆM3Uæ–‡ä»¶: ku9.m3u

å·²è·³è¿‡ 0 ä¸ªç¼ºå°‘æ’­æ”¾é“¾æŽ¥çš„é¢‘é“ã€‚
æ€»å…±è¿‡æ»¤ 14 ä¸ªé»‘åå•é¢‘é“ï¼ˆä¸»JSON: 14, è‡ªå®šä¹‰: 0ï¼‰
æˆåŠŸç”Ÿæˆ 191 ä¸ªé¢‘é“
å•æ’­åœ°å€åˆ—è¡¨: \\DS920\web\IPTV\cmcc_iptv_auto_py\tv2.m3u
KU9å›žçœ‹å‚æ•°åˆ—è¡¨: \\DS920\web\IPTV\cmcc_iptv_auto_py\ku9.m3u
å·²ç”Ÿæˆå¤„ç†æ—¥å¿—: \\DS920\web\IPTV\cmcc_iptv_auto_py\channel_processing.log

å¼€å§‹ä¸‹è½½èŠ‚ç›®å•...
EPG æ¨¡å¼: M3U_ONLY (ä»…ä¸‹è½½å’Œåˆæˆ M3U ä¸­çš„é¢‘é“)
æ€»å…±å°†ä¸º 191 ä¸ª M3U é¢‘é“æ¡ç›®å°è¯•ä¸‹è½½EPGã€‚
XML æ–‡ä»¶å°†åŸºäºŽè¿™ 191 ä¸ªé¢‘é“ç”Ÿæˆã€‚
å‡†å¤‡å¹¶è¡Œä¸‹è½½ 191 ä¸ªé¢‘é“çš„EPGï¼Œä½¿ç”¨ 2 ä¸ªepgåœ°å€ä¸‹è½½...
  ä¸‹è½½è¿›åº¦: 191/191 ä¸ªé¢‘é“ (100.0%)
æ‰€æœ‰ä¸‹è½½ä»»åŠ¡å·²å®Œæˆã€‚
å·²ä¿å­˜èŠ‚ç›®å•XMLæ–‡ä»¶åˆ°: \\DS920\web\IPTV\cmcc_iptv_auto_py\t.xml
å·²ç”ŸæˆåŽ‹ç¼©æ–‡ä»¶: \\DS920\web\IPTV\cmcc_iptv_auto_py\t.xml.gz

==================================================
EPG åˆæˆç»Ÿè®¡
==================================================

åŸºæœ¬ç»Ÿè®¡:
   - XML ä¸­æ€»å…±å†™å…¥ 176 ä¸ªé¢‘é“
   - å…¶ä¸­ 176 ä¸ªé¢‘é“æˆåŠŸåˆæˆäº†èŠ‚ç›®æ•°æ®
   - æ€»å…±åˆæˆäº† 11731 ä¸ªèŠ‚ç›®æ¡ç›®
   - å·²è·³è¿‡ 15 ä¸ªæ²¡æœ‰èŠ‚ç›®æ•°æ®çš„é¢‘é“

è¯¦ç»†ç»Ÿè®¡å·²ä¿å­˜åˆ°: \\DS920\web\IPTV\cmcc_iptv_auto_py\epg_statistics.log
```

## ðŸ“¡ ç½‘ç»œçŽ¯å¢ƒé…ç½®

### å‰ææ¡ä»¶

- **ðŸŒ å¹¿ä¸œç§»åŠ¨å®½å¸¦**ï¼šè„šæœ¬éœ€è¦è®¿é—® `183.235.0.0/16` ç½‘æ®µçš„IPTVæœåŠ¡å™¨
- **ðŸ”Œ IPTVæŽ¥å£**ï¼šéœ€è¦é…ç½®IPTVç½‘ç»œæŽ¥å£ï¼ˆå¦‚ `br-iptv`ï¼‰

### çŽ¯å¢ƒè¯´æ˜Ž

**ðŸ’¡ æ¥¼ä¸»çŽ¯å¢ƒï¼šå¹¿ä¸œç§»åŠ¨å®½å¸¦**

- **ðŸ“¶ è·¯ç”±å™¨**ï¼šimmortalwrt 23.05ï¼Œå•çº¿å¤ç”¨ï¼Œå…‰çŒ«åˆ°å®¢åŽ…åªè¦ä¸€æ¡çº¿

![å•çº¿å¤ç”¨é…ç½®](files/20251107165649301.webp)

- **ðŸ”§ å…‰çŒ«é…ç½®**ï¼šå…‰çŒ«æ”¹æ¡¥æŽ¥åŽï¼Œåªä¿®æ”¹interneté‚£è¾¹çš„vlanï¼Œå°±æ˜¯åˆ’åˆ†internet vlanåˆ°å•çº¿å¤ç”¨çº¿æŽ¥å£ï¼Œç”¨æˆ·ä¾§è‡ªå®šä¹‰ï¼Œè®¾ä¸º3ï¼Œiptvä¸åˆ’vlanï¼Œå•çº¿å¤ç”¨å£ç›´å‡ºï¼ˆå› ä¸ºæµ‹è¯•è¿‡iptvåˆ’vlanå¯¼è‡´4åˆ†é’Ÿå¡é¡¿ï¼‰
- **âš™ï¸ è·¯ç”±å™¨é…ç½®**ï¼šwanå£ä¸Šç½‘ç”¨vlanå°±æ˜¯eth1.3ï¼Œæ–°å»ºiptvå£ä¸ç”¨vlanï¼Œè®¾ç½®å°±æ˜¯eth1ï¼Œiptvå£ä¸ºbr-iptv(dhcpæ¨¡å¼)ï¼Œæœºé¡¶ç›’æ¡¥æŽ¥br-iptvç½‘ç»œå¯ä»¥æ­£å¸¸è§‚çœ‹
- **ðŸ” é‰´æƒè®¾ç½®**ï¼šç”±äºŽå®žæµ‹ç§»åŠ¨iptvä¸é‰´æƒï¼Œæ‰€ä»¥æ²¡æœ‰é’ˆå¯¹è®¾ç½®hostnameã€macåœ°å€ã€Vendor class identifierè®¾ç½®
  - âš ï¸ å¦‚æžœè®¾ç½®äº†æœºé¡¶ç›’macç­‰ï¼Œå¯¼è‡´æœºé¡¶ç›’ä¸å¯ç”¨äº†

### ðŸ” æŠ“åŒ…èŽ·å–é¢‘é“æ•°æ®ï¼ˆå¯é€‰ï¼‰

å¦‚æžœéœ€è¦æ‰‹åŠ¨èŽ·å–é¢‘é“æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š

#### 1. ðŸ“¦ ä½¿ç”¨tcpdumpæŠ“åŒ…

```bash
# immortalwrt å®‰è£…tcpdump
tcpdump -i br-iptv -w /tmp/iptv_capture.pcap

# æ‰“å¼€ç›’å­ç”µæºï¼Œç­‰å¾…å¯åŠ¨å®ŒæˆåŽæ‰“å¼€ç›´æ’­éšä¾¿åˆ‡å‡ ä¸ªå°ã€‚å›žçœ‹ä¸€ä¸‹,ç„¶åŽç»“æŸ
```

#### 2. ðŸ” ä½¿ç”¨Wiresharkåˆ†æž

å°†æŠ“åŒ…æ–‡ä»¶æå–åˆ°Windowsï¼Œç”¨Wiresharkåˆ†æžï¼š

![Wiresharkåˆ†æž](files/pixpin_2025-10-15_20-54-37.png)

æŒ‰å¤§å°æŽ’åºå¾—åˆ°200kå·¦å³çš„getChannelçš„jsonæ–‡ä»¶ï¼š

![æŒ‰å¤§å°æŽ’åº](files/pixpin_2025-10-15_20-55-19.png)

æŒ‰å¤§å°æŽ’åºæœ€å¤§çš„æ˜¯å›žçœ‹æµé‡ï¼Œæˆ‘çš„æ˜¯ä¸­å…´æ ¼å¼ï¼ŒåŽä¸ºå›žçœ‹æµé‡æš‚æœªå®žçŽ°ï¼Œä½†åŽä¸ºç”¨æˆ·ä¹Ÿå¯ä»¥ç›´æŽ¥ä½¿ç”¨ä¸­å…´æ ¼å¼

![](https://r2.bennq.top/piclist/20251119121036543.webp)

ç‚¹å‡» 10 MB æ•°æ®ï¼Œå…³é—­çª—å£ï¼Œè¿½è¸ª HTTP æµã€‚

![è¿½ç»ˆhttpæµ](files/PixPin_2025-11-20_14-20-33.webp)

æ‹¼æŽ¥å›žçœ‹åœ°å€ã€‚

![å¹¶æŽ¥åœ°å€](files/PixPin_2025-11-20_14-22-10.webp)

æ‹¼æŽ¥ GET Host å¤´å¾—å‡ºå›žçœ‹çš„å®žé™…åœ°å€ï¼Œå¯ä»¥ç›´æŽ¥åœ¨ MPV æˆ–è€… PotPlayer æ’­æ”¾ï¼š
`http://183.235.162.80:6610//190000002005/ch000000000000328/index.m3u8?AuthInfo=xxx&version=xxx&starttime=20251015T220000.00Z&endtime=20251016T000000.00Z&IASHttpSessionId=RR14723020251016084714108007&ispcode=7`

ç®€åŒ–åŽæ’­æ”¾æ­£å¸¸ï¼š

`http://183.235.162.80:6610//190000002005/ch000000000000328/index.m3u8?starttime=20251015T220000.00Z&endtime=20251016T000000.00Z`

å¾—å‡ºå›žçœ‹æºå‰ç¼€ï¼š`http://183.235.162.80:6610//190000002005`

#### 3. ðŸ“¡ åˆ†æžå¾—åˆ°çš„ API åœ°å€

åˆ†æžæŠ“åŒ…æ•°æ®å¯ä»¥å¾—åˆ°ä»¥ä¸‹å¯è®¿é—®åœ°å€ï¼š

```
http://183.235.11.39:8082/epg/api/custom/getChannelsInCategory.json?code=category_54543193 
http://183.235.11.39:8082/epg/api/custom/getAllChannel.json  æ²¡æœ‰æ™´å½©  çœ‹æ¥æœåŠ¡åœ°å€ä¸åŒè¿”å›žä¸åŒçš„é¢‘é“

http://183.235.16.92:8082/epg/api/custom/getAllChannel.json    è¿™ä¸ªåœ°å€ä¹Ÿè¡Œ,è€Œä¸”æ˜¯æ ‡å‡†çš„jsonæ ¼å¼  å¤šäº†æ™´å½©é¢‘é“
http://183.235.16.92:8082/epg/api/custom/getAllChannel2.json 
```

**âš ï¸ æ³¨æ„**ï¼š**é»˜è®¤ç½‘ç»œæ˜¯æ— æ³•è®¿é—® `183.235.0.0/16` çš„æµé‡ï¼Œå¿…é¡»é€šè¿‡iptvç«¯å£ã€‚ç½‘ä¸Šæœ‰æ‰‹åŠ¨æ·»åŠ é™æ€è·¯ç”±çš„åŠžæ³•ï¼Œä½†æ˜¯å®žæµ‹dhcpèŽ·å¾—çš„ipä¼šå˜åŠ¨ï¼Œæœ‰æ—¶æ˜¯100.93.0.Xï¼Œæœ‰æ—¶æ˜¯10.150.0.xï¼Œæœ‰æ—¶æ˜¯100.125.71.xã€‚**

### ðŸ›£ï¸ è‡ªåŠ¨è·¯ç”±é…ç½®

ç”±äºŽé»˜è®¤ç½‘ç»œæ— æ³•è®¿é—® `183.235.0.0/16` æµé‡ï¼Œéœ€è¦é…ç½®è·¯ç”±ã€‚è„šæœ¬æä¾›äº†è‡ªåŠ¨è·¯ç”±é…ç½®æ–¹æ¡ˆï¼š

- ðŸ”„ æ ¹æ® br-iptv æŽ¥å£çš„ DHCP ç½‘å…³è‡ªåŠ¨æ›´æ–°é™æ€è·¯ç”±
- ðŸ›£ï¸ å°†br-iptv æŽ¥å£èŽ·å–åˆ°çš„dhcp ipæœ€åŽä¸€ä½æ”¹ä¸º1åŽåŠ å…¥åˆ°è·¯ç”±ç½‘å…³ï¼Œ183.235.0.0/16 æµé‡ä¼šç»è¿‡æ–°è®¾ç½®çš„ç½‘å…³å‡ºå£ï¼Œä»Žè€Œå®žçŽ°è‡ªåŠ¨æ›´æ–°è®¿é—®183æµé‡
- âš ï¸ **æ³¨æ„ï¼Œbr-iptv æŽ¥å£ä¸ºdhcpæ¨¡å¼**ï¼Œé˜²ç«å¢™å‚è€ƒä¸‹é¢è®¾ç½®

#### 1. ðŸ“ åˆ›å»ºè·¯ç”±æ›´æ–°è„šæœ¬

```bash
cat > /usr/bin/update-iptv-route << 'EOF'
#!/bin/sh

IP=$(ip addr show br-iptv 2>/dev/null | grep -o 'inet [0-9.]*/' | cut -d' ' -f2 | cut -d'/' -f1)

[ -z "$IP" ] && exit 1

CURRENT_GW=$(echo "$IP" | awk -F. '{print $1"."$2"."$3".1"}')

ip route del 183.235.0.0/16 2>/dev/null
ip route add 183.235.0.0/16 via "$CURRENT_GW" dev br-iptv
EOF

chmod +x /usr/bin/update-iptv-route
```

#### 2. ðŸ”Œ åˆ›å»ºç½‘ç»œæŽ¥å£çƒ­æ’æ‹”è„šæœ¬

```bash
cat > /etc/hotplug.d/iface/99-iptv-route << 'EOF'
#!/bin/sh

[ "$ACTION" = "ifup" ] && [ "$INTERFACE" = "iptv" ] || exit 0

echo "IPTV æŽ¥å£å·²å¯åŠ¨ï¼Œç­‰å¾…ç½‘ç»œå°±ç»ª..."
sleep 10
/usr/bin/update-iptv-route
EOF

chmod +x /etc/hotplug.d/iface/99-iptv-route
```

#### 3. âš™ï¸ é…ç½®ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨è¿è¡Œ

```bash
# æ·»åŠ åˆ° rc.local ç¡®ä¿å¯åŠ¨æ—¶è¿è¡Œ
echo "sleep 25 && /usr/bin/update-iptv-route" >> /etc/rc.local
```

#### 4. âœ… éªŒè¯è·¯ç”±é…ç½®

```bash
# æ‰‹åŠ¨æµ‹è¯•è·¯ç”±è„šæœ¬
/usr/bin/update-iptv-route

# æ£€æŸ¥è·¯ç”±æ˜¯å¦æ·»åŠ 
ip route | grep 183.235
```

### ðŸ”¥ é˜²ç«å¢™é…ç½®

éœ€è¦åœ¨é˜²ç«å¢™ä¸­é…ç½®LANåˆ°IPTVçš„è½¬å‘è§„åˆ™ï¼Œå…è®¸è®¿é—®IPTVç½‘ç»œã€‚

![é˜²ç«å¢™é…ç½®](files/pixpin_2025-11-05_22-39-00.webp)

## ðŸ§ª åˆæ­¥æµ‹è¯•

### ðŸŒ å®žçŽ°æµè§ˆå™¨è®¿é—®

æµ‹è¯•JSONæ•°æ®æºæ˜¯å¦å¯è®¿é—®ï¼š
- [http://183.235.16.92:8082/epg/api/custom/getAllChannel.json](http://183.235.16.92:8082/epg/api/custom/getAllChannel.json)

### âª å®žçŽ°å›žçœ‹æµ‹è¯•

å®žçŽ° potplayer æˆ–è€… mpv å›žçœ‹ï¼Œstarttime/endtime ä¿®æ”¹ä¸ºæ˜¨å¤©é—´éš” 5 å°æ—¶å†…çš„å‚æ•°ï¼š

```
http://183.235.162.80:6610/190000002005/ch000000000000329/index.m3u8?starttime=20251118100000&endtime=20251118112000
```



## ðŸŒ Nginxä»£ç†é…ç½®ï¼ˆå¤–ç½‘è®¿é—®ï¼‰

- ðŸŒ å¦‚æžœéœ€è¦é€šè¿‡å¤–ç½‘è®¿é—®å›žçœ‹åŠŸèƒ½ï¼Œéœ€è¦é…ç½®Nginxä»£ç†ã€‚é»˜è®¤ä¸ºç©ºï¼Œæƒ³å®žçŽ°å±€åŸŸç½‘è§‚çœ‹å†è€ƒè™‘å›žæ¥è®¾ç½®
- ðŸ“ è¦æ±‚è‡ªæœ‰åŸŸåã€DDNS

### 1. ðŸ“¦ å®‰è£…Nginx

```bash
opkg update
opkg install nginx
```

### 2. âš™ï¸ ç¦ç”¨UCIç®¡ç†

- âš ï¸ ç”±äºŽopenwrté»˜è®¤ä½¿ç”¨ucié…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åˆ é™¤æˆ–è€…ç¦ç”¨
  - ä¿®æ”¹ `/etc/config/nginx`ï¼Œå°† `uci_enable` è®¾ç½®ä¸º `false`ï¼Œæˆ–åˆ é™¤UCIé…ç½®ä¸­çš„serverå—ã€‚

### 3. ðŸ”§ é…ç½®Nginxä»£ç†

åˆ›å»ºä»£ç†é…ç½®æ–‡ä»¶ï¼š
- è§£æžå™¨è®¾ç½®ä¸ºè‡ªå·±çš„ OpenWrt IPï¼Œä¹Ÿå°±æ˜¯ DNSï¼Œå¯è®¾ä¸º 223.5.5.5ã€‚

```bash
cat > /etc/nginx/conf.d/nginx-proxy.conf << 'EOF'
server {
    listen 7077;
    listen [::]:7077;
    
    # è§£æžå™¨è®¾ç½®
    resolver 10.10.10.1;
    
    # é€šç”¨ä»£ç† - æ”¯æŒä»»æ„ç›®æ ‡åœ°å€
    location ~* "^/(?<target_host>[^/]+)(?<target_path>.*)$" {
        # æž„å»ºä»£ç†ç›®æ ‡URL
        set $proxy_target "http://$target_host$target_path$is_args$args";
        
        proxy_pass $proxy_target;
        proxy_set_header Host $target_host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        proxy_connect_timeout 30s;
        proxy_send_timeout 600s;
        proxy_read_timeout 600s;
        proxy_buffering off;
    }
}
EOF
```

### 4. ðŸ“ é…ç½®ä¸»é…ç½®æ–‡ä»¶

```bash
cat > /etc/nginx/nginx.conf << 'EOF'
user root;
worker_processes 1;

error_log /var/log/nginx/error.log;
pid /var/run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    access_log off;

    sendfile on;
    keepalive_timeout 65;

    include /etc/nginx/conf.d/*.conf;
}
EOF
```

### 5. âœ… æ£€æŸ¥å’Œç®¡ç†Nginx

```bash
# æ£€æŸ¥é…ç½®æ˜¯å¦æœ‰æ•ˆ
nginx -t

# æ£€æŸ¥è¿›ç¨‹å’Œç«¯å£
ps | grep nginx
netstat -ln | grep 7077

# é‡è½½Nginx
/etc/init.d/nginx reload
/etc/init.d/nginx restart
```

é…ç½®å®ŒæˆåŽï¼Œtv.pyæ–‡ä»¶ä¿®æ”¹ `NGINX_PROXY_PREFIX = "http://c.top:7077"`ï¼Œå›žçœ‹åœ°å€å’ŒLogoåœ°å€ä¼šè‡ªåŠ¨é€šè¿‡Nginxä»£ç†ï¼š

- âª å›žçœ‹åœ°å€ï¼š`http://c.top:7077/183.235.162.80:6610/190000002005/ch000000000000104/index.m3u8?starttime=...`
- ðŸ–¼ï¸ Logoåœ°å€ï¼š`http://c.top:7077/183.235.16.92:8081/pics/micro-picture/channelNew/xxx.png`

## â° å®šæ—¶ä»»åŠ¡

å»ºè®®å°†è„šæœ¬æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡ä¸­ï¼Œå®šæœŸæ›´æ–°é¢‘é“åˆ—è¡¨å’ŒEPGã€‚

### ðŸ–¥ï¸ ç¾¤æ™–NAS

åœ¨ç¾¤æ™–çš„"ä»»åŠ¡è®¡åˆ’å™¨"ä¸­æ·»åŠ å®šæ—¶ä»»åŠ¡ã€‚

### ðŸ§ Linux/OpenWrt

ä½¿ç”¨crontabï¼š

```bash
# ç¼–è¾‘crontab
crontab -e

# æ·»åŠ ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹è¿è¡Œï¼‰
0 2 * * * cd /path/to/script && /usr/bin/python3 tv.py
```

## ðŸ”§ æŠ€æœ¯ç»†èŠ‚

### ðŸ“Š é¢‘é“åˆ†ç»„é€»è¾‘

è„šæœ¬æŒ‰ç…§ä»¥ä¸‹ä¼˜å…ˆçº§å¯¹é¢‘é“è¿›è¡Œåˆ†ç±»ï¼š

1. ðŸŽ¬ å°‘å„¿ï¼ˆå¿…é¡»åœ¨å¤®è§†ä¹‹å‰,é¿å…CCTVå°‘å„¿è¢«åˆ†åˆ°å¤®è§†ç»„ï¼‰
2. ðŸŽ¥ è¶…æ¸…4kï¼ˆå¿…é¡»åœ¨å¤®è§†ä¹‹å‰ï¼‰
3. ðŸ“º å¤®è§†
4. â­ å¤®è§†ç‰¹è‰²
5. ðŸ  å¹¿ä¸œ
6. ðŸŒ CGTN
7. ðŸ“¡ å«è§†
8. ðŸŽ® åŽæ•°å’ªå’•
9. ðŸ“‹ å…¶ä»–
10. ðŸ˜ï¸ å¹¿ä¸œåœ°æ–¹å°

### ðŸ“º EPGä¸‹è½½æœºåˆ¶

- ðŸŒ æ”¯æŒå¤šæºå¹¶è¡Œä¸‹è½½ï¼Œè‡ªåŠ¨åˆ†é…ä»»åŠ¡
- ðŸ“… è‡ªåŠ¨ä¸‹è½½å½“å¤©å’Œæ¬¡æ—¥çš„EPGæ•°æ®
- ðŸ”„ æ”¯æŒé‡è¯•æœºåˆ¶ï¼ˆé»˜è®¤é‡è¯•3æ¬¡ï¼‰
- ðŸ“Š æ˜¾ç¤ºå®žæ—¶ä¸‹è½½è¿›åº¦

### âª å›žçœ‹URLæ ¼å¼

- **æ ‡å‡†æ ¼å¼**ï¼š`{prefix}/{ztecode}/index.m3u8?starttime=${{utc:yyyyMMddHHmmss}}&endtime=${{utcend:yyyyMMddHHmmss}}`
- **KU9æ ¼å¼**ï¼š`{prefix}/{ztecode}/index.m3u8?starttime=${{(b)yyyyMMddHHmmss|UTC}}&endtime=${{(e)yyyyMMddHHmmss|UTC}}`

## ðŸ“š å‚è€ƒèµ„æº

- ðŸ“– [IPTVç›¸å…³æ•™ç¨‹](https://www.hyun.tech/archives/iptv)
- ðŸ”— [gmcc-iptvé¡¹ç›®](https://github.com/pcg562240/gmcc-iptv)
- ðŸ› ï¸ [iptv-toolå·¥å…·](https://github.com/taksssss/iptv-tool) - ä¸ºæ²¡æœ‰EPGçš„é¢‘é“æä¾›é¢å¤–æ”¯æŒ
- ðŸ’¬ [æ©å±±åŽŸå¸–](https://www.right.com.cn/forum/thread-8453808-1-1.html)

## ðŸ“Š æ•ˆæžœå±•ç¤º

### ä½¿ç”¨æ•ˆæžœ

- **ðŸŒ åŒåŸŽç§»åŠ¨å¤§å±€åŸŸç½‘è®¿é—®æ­£å¸¸**ï¼šå¤šå¥—æˆ¿å­å®žçŽ°å…±äº«ï¼Œé‰´äºŽä¸Šä¼ å¸¦å®½40mbpsï¼Œæ­£å¸¸åªæ”¯æŒå¤–ç½‘4è·¯8mç çŽ‡çš„
- **ðŸ“º EPGæ•°æ®å®Œæ•´**ï¼šå¤§éƒ¨åˆ†é¢‘é“æœ‰æ˜Žå¤©çš„epgï¼Œç½‘ä¸Šçš„åŸºæœ¬éƒ½æ˜¯å½“å¤©çš„ï¼Œå›žçœ‹æ­£å¸¸ï¼Œåªé’ˆå¯¹é…·9æœ€æ–°ç‰ˆæœ¬
- **ðŸ˜ï¸ æœ¬åœ°å°æ”¯æŒ**ï¼šç¼ºå¤±å¤§éƒ¨åˆ†å¹¿ä¸œæœ¬åœ°å°çš„ztecodeã€codeï¼Œå› ä¸ºé»˜è®¤jsonéƒ½ä¸å¸¦æœ¬åœ°å°ï¼Œéœ€è¦é€šè¿‡ `custom_channels.json` æ‰‹åŠ¨æ·»åŠ 

### æ’­æ”¾å™¨æ•ˆæžœæˆªå›¾

![æ•ˆæžœå±•ç¤º1](files/pixpin_2025-11-03_18-36-13.webp)

![æ•ˆæžœå±•ç¤º2](files/pixpin_2025-11-03_18-36-23.webp)

![æ•ˆæžœå±•ç¤º3](files/pixpin_2025-11-03_18-36-30.webp)

![æ•ˆæžœå±•ç¤º4](files/pixpin_2025-11-03_18-36-43.webp)

![æ•ˆæžœå±•ç¤º5](files/pixpin_2025-11-03_18-37-01.webp)

![æ•ˆæžœå±•ç¤º6](files/pixpin_2025-11-03_18-39-11.webp)

![æ•ˆæžœå±•ç¤º7](files/pixpin_2025-11-03_18-39-40.webp)

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ðŸŒ ç½‘ç»œè®¿é—®**ï¼šè„šæœ¬éœ€è¦èƒ½å¤Ÿè®¿é—® `183.235.0.0/16` ç½‘æ®µï¼Œå¿…é¡»é€šè¿‡IPTVæŽ¥å£
2. **ðŸ“‹ é¢‘é“æ•°æ®**ï¼šé»˜è®¤JSONå¯èƒ½ä¸åŒ…å«æ‰€æœ‰æœ¬åœ°å°ï¼Œéœ€è¦é€šè¿‡ `custom_channels.json` æ‰‹åŠ¨æ·»åŠ 
3. **â° å›žçœ‹æ—¶é—´**ï¼šå›žçœ‹ä½¿ç”¨UTCæ—¶é—´
4. **ðŸ“º EPGæ•°æ®**ï¼šå¤§éƒ¨åˆ†é¢‘é“æœ‰æ¬¡æ—¥çš„EPGæ•°æ®ï¼Œæ¯”ç½‘ä¸Šå¸¸è§çš„EPGæºæ›´å®Œæ•´
5. **âª é¢å¤–ä¸»json**ï¼š[http://183.235.16.92:8082/epg/api/getAllChannel.json](http://183.235.16.92:8082/epg/api/getAllChannel.json) è¿™ä¸ªåœ°å€åŒ…å«å¤§é‡åœ°æ–¹å°ï¼Œä½†æ˜¯è¿‘100ä¸ªå¤±æ•ˆï¼Œæš‚æ—¶ä¸é‡‡ç”¨ï¼Œå¯ä»¥ä½œä¸ºè‡ªå®šä¹‰å‚è€ƒ

## ðŸ› é—®é¢˜åé¦ˆ

å¦‚æžœè„šæœ¬è¿è¡Œå‡ºçŽ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. ðŸ“ æŸ¥çœ‹ `channel_processing.log` äº†è§£é¢‘é“å¤„ç†è¯¦æƒ…
2. ðŸ“Š æŸ¥çœ‹ `epg_statistics.log` äº†è§£EPGä¸‹è½½æƒ…å†µ
3. ðŸ” æ£€æŸ¥ç½‘ç»œè¿žæŽ¥å’Œè·¯ç”±é…ç½®
4. ðŸ¤– ä½¿ç”¨AIå·¥å…·åˆ†æžé”™è¯¯ä¿¡æ¯

## ðŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨ã€‚
